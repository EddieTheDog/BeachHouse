<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beach House Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<style>
  body {
    font-family: system-ui, sans-serif;
    background: #e0f7fa;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
  }
  h1 { margin-bottom: 10px; }
  .weather { margin-bottom: 20px; font-size: 1.2rem; }
  form { display: flex; flex-direction: column; gap: 10px; width: 300px; }
  input, textarea, button { padding: 10px; font-size: 1rem; width: 100%; border-radius: 5px; border: 1px solid #ccc; }
  button { cursor: pointer; background: #0077cc; color: white; border: none; }
  #confirmation { color: green; margin-top: 10px; }
</style>
</head>
<body>

<h1>Beach House Dashboard</h1>
<div class="weather" id="weather">Loading weather...</div>

<form id="requestForm">
  <input type="text" id="name" placeholder="Your Name" required>
  <input type="text" id="room" placeholder="Room / Unit #" required>
  <textarea id="request" placeholder="Work Request" required></textarea>
  <button type="submit">Submit Request</button>
</form>
<div id="confirmation"></div>

<script>
  // === Supabase Setup ===
  const supabaseUrl = 'https://ofnlpqfscyecatetnuqi.supabase.co';
  const supabaseKey = 'sb_publishable_jjdmHkgGrbjqYwY14kS9ng_Ivuq-Pjc';
  const supabase = supabase.createClient(supabaseUrl, supabaseKey);

  const form = document.getElementById('requestForm');
  const confirmation = document.getElementById('confirmation');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('name').value;
    const room = document.getElementById('room').value;
    const requestText = document.getElementById('request').value;

    try {
      await supabase.from('work_requests').insert([{ name, room, request: requestText, status: 'Pending' }]);
      confirmation.innerText = "Request submitted!";
      form.reset();
    } catch (err) {
      confirmation.innerText = "Error submitting request.";
      console.error(err);
    }
  });

  // === OpenWeatherMap API for Orange County ===
  const weatherEl = document.getElementById('weather');
  const apiKey = 'YOUR_OPENWEATHERMAP_API_KEY'; // Replace with your free key
  const location = 'Orange County, US';

  async function getWeather() {
    try {
      const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(location)}&units=imperial&appid=${apiKey}`);
      const data = await res.json();
      weatherEl.innerText = `Weather: ${data.main.temp}Â°F, ${data.weather[0].description}`;
    } catch (err) {
      weatherEl.innerText = 'Weather unavailable';
    }
  }

  getWeather();
</script>
</body>
</html>
