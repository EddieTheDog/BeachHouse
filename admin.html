<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Beach House Admin</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-slate-100 font-sans p-8">

<div class="max-w-4xl mx-auto">
    <header class="mb-8">
        <h1 class="text-3xl font-black italic tracking-tighter">HOST CONTROL</h1>
    </header>

    <section class="bg-white p-8 rounded-[2rem] shadow-sm mb-8">
        <h2 class="font-bold text-lg mb-4">Register Family</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
            <input type="text" id="last_name" placeholder="Last Name (e.g. Miller)" class="border p-4 rounded-2xl outline-none focus:ring-2 focus:ring-blue-600">
            <input type="date" id="check_in" class="border p-4 rounded-2xl">
            <input type="date" id="check_out" class="border p-4 rounded-2xl">
        </div>
        <button id="create-btn" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black text-lg hover:bg-blue-700 transition">GENERATE STAY & CODE</button>
    </section>

    <div id="guest-list" class="space-y-4"></div>
</div>

<script>
const SUPABASE_URL = 'https://ofnlpqfscyecatetnuqi.supabase.co';
const SUPABASE_KEY = 'sb_publishable_jjdmHkgGrbjqYwY14kS9ng_Ivuq-Pjc';
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

function generatePIN() { return Math.floor(100000 + Math.random() * 900000).toString(); }

document.getElementById('create-btn').onclick = async () => {
    const ln = document.getElementById('last_name').value;
    const ci = document.getElementById('check_in').value;
    const co = document.getElementById('check_out').value;
    const pin = generatePIN();

    if(!ln || !ci || !co) return alert("Fill all info!");

    await supabaseClient.from('families').insert({ 
        last_name: ln, check_in_date: ci, check_out_date: co, access_code: pin 
    });
    
    document.getElementById('last_name').value = '';
    alert(`Success! Tell the ${ln} family their code is: ${pin}`);
    loadGuests();
};

async function loadGuests() {
    const { data } = await supabaseClient.from('families').select('*').order('check_in_date', {ascending: true});
    const list = document.getElementById('guest-list');
    list.innerHTML = data?.map(f => `
        <div class="bg-white p-6 rounded-2xl flex justify-between items-center border border-slate-200 shadow-sm">
            <div>
                <h3 class="font-black text-xl uppercase">${f.last_name} Family</h3>
                <p class="text-blue-600 font-mono font-black text-lg">CODE: ${f.access_code}</p>
            </div>
            <div class="text-right">
                <p class="text-xs font-bold text-slate-400 uppercase">${f.check_in_date} to ${f.check_out_date}</p>
                <button onclick="del('${f.id}')" class="text-red-500 font-bold text-xs mt-2 hover:underline">Delete Guest</button>
            </div>
        </div>
    `).join('') || '';
}

window.del = async (id) => {
    if(confirm("Delete this guest?")) {
        await supabaseClient.from('families').delete().eq('id', id);
        loadGuests();
    }
};

loadGuests();
</script>
</body>
</html>
