<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Beach House Admin</title>
<style>
  body{ font-family:sans-serif; padding:20px;}
  input, button{margin:5px;}
  .family{border:1px solid #ccc; padding:5px; margin:5px;}
</style>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
<h1>Admin Dashboard</h1>

<h2>Create / Edit Family</h2>
<input type="text" id="last_name" placeholder="Last Name">
<input type="date" id="check_in">
<input type="date" id="check_out">
<button id="create">Create / Update</button>

<h2>Actions</h2>
<button id="lock">Lock All Tablets</button>
<button id="unlock">Unlock All Tablets</button>
<input type="text" id="announcement_msg" placeholder="Announcement">
<button id="send_announcement">Send Announcement</button>

<h2>Families</h2>
<div id="family-list"></div>

<script>
document.addEventListener('DOMContentLoaded', async function() {
  // Initialize Supabase first
  const SUPABASE_URL = 'https://ofnlpqfscyecatetnuqi.supabase.co';
  const SUPABASE_KEY = 'sb_publishable_jjdmHkgGrbjqYwY14kS9ng_Ivuq-Pjc';
  const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  // Load families and display
  async function loadFamilies(){
    const { data } = await supabase.from('families').select('*');
    const list = document.getElementById('family-list');
    list.innerHTML = '';
    if(!data || data.length === 0){
      list.innerHTML = "<p>No families currently created.</p>";
      return;
    }
    data.forEach(f=>{
      const div = document.createElement('div');
      div.classList.add('family');
      div.innerHTML = `<b>${f.last_name}s</b> | ${f.check_in_date} â†’ ${f.check_out_date} 
        <button onclick="checkout('${f.id}')">Check Out</button>`;
      list.appendChild(div);
    });
  }

  // Checkout function
  window.checkout = async function(id){
    await supabase.from('families').update({checked_in:false}).eq('id',id);
    loadFamilies();
  }

  // Create / update family
  document.getElementById('create').onclick = async ()=>{
    const ln = document.getElementById('last_name').value;
    const ci = document.getElementById('check_in').value;
    const co = document.getElementById('check_out').value;
    if(!ln || !ci || !co){ alert("Fill all fields"); return; }
    await supabase.from('families').upsert({last_name: ln, check_in_date: ci, check_out_date: co});
    loadFamilies();
  }

  // Send announcement
  document.getElementById('send_announcement').onclick = async ()=>{
    const msg = document.getElementById('announcement_msg').value;
    if(!msg) return;
    await supabase.from('announcements').insert({message: msg});
    document.getElementById('announcement_msg').value = '';
  }

  // Lock / Unlock placeholders
  document.getElementById('lock').onclick = ()=> alert("Tablets locked (placeholder)");
  document.getElementById('unlock').onclick = ()=> alert("Tablets unlocked (placeholder)");

  loadFamilies();
});
</script>
</body>
</html>
